## 统一登录（注册）流程

本文档描述了包含手机号和第三方登录的完整接口调用流程。

下面以手机号登录为例进行描述。此外，下述文字中提到的前端包含移动app、web端和小程序等。

### 1. 前端调用 SignInAll 接口（提供手机号和验证码）

前端提供手机号和验证码，并调用统一登录接口（SignInAll）进行登录。

### 2. 后端 SignInAll 接口逻辑

这里分为两种情况：

- 若手机号已完成注册流程，则直接返回登录成功的token。
- 若手机号从未进行注册，则统一登录接口（SignInAll）会返回一个标记字段，提示前端需要进行注册流程（token字段空）。
    - 统一注册接口是 SignUpAll。

**注意**：我们不能在 SignInAll 接口完成自动注册，因为此时用户没有提供任何基础信息（昵称、性别等），
没有任何基础资料的账户一般来说是无意义的。

### 3. 前端调用 SignUpAll 接口（提供手机号和验证码和用户基本信息）

上一步中，前端得知手机号未完成注册流程，一般需要引导用户在前端执行注册流程，比如选择性别、填写昵称、发送验证码等步骤，
最后点击注册按钮（调用 SignUpAll 接口）。

这一步中，前端提供了手机号、验证码和用户基本信息，SignUpAll 接口在检查验证码通过后即可为用户完成注册流程，
同时返回一个登录成功的token（前端提示注册成功，可自动跳转用户主页）。

**若希望快速完成注册流程**，可以允许前端调用此接口时不传入用户基本信息，直接完成注册。

> **后端**注意：上述流程中，用户的同个验证码需要验证两次，所以首次验证通过后不要删除验证码（但存在有效期）。

### 4. OAuthのGithub登陆

[官方文档](https://docs.github.com/zh/apps/oauth-apps/building-oauth-apps/creating-an-oauth-app)

1. 访问 GitHub Developer settings 页面，注册我的OAuth应用，得到 Client ID 和 Client Secret
2. 当用户点击 GitHub 登录按钮时，重定向用户到 GitHub 的登录授权页面，登录成功后，GitHub 会重定向到我们指定的回调地址，同时会带上一个授权码
   code 参数，您的应用需要使用这个授权码向 GitHub 请求访问令牌（access token）。
3. 使用 access token 向GitHub请求用户信息，获取用户名、头像、昵称等基本信息。